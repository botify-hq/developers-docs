# Botify for Google Sheets

**Botify for Google Sheets** allows you to easily get Botify data in your spreadsheets.
Note that, currently only a small subset of the API is supported by this SDK. Feel free to customize our macros or contributing to the project.


## Install

- Open the [addon page](https://chrome.google.com/webstore/detail/botify-macros/albleinfohecbdikaabneehekfmdgimk).
- Click on Add


## Macros

Every macro is prefixed by Botify, thus typing `=BOTIFY` in a cell formula  should show you the available macros thanks to the autocompletion.

- [BOTIFY_PROJECT_LIST_ANALYSES](#get-latest-projects-analyses)
- [BOTIFY_PROJECT_AGGREGATE_URLS](#aggregate-project-urls-data)
- [BOTIFY_ANALYSIS_AGGREGATE_URLS](#aggregate-analysis-urls-data)
- [BOTIFY_ANALYSIS_LIST_URLS](#list-urls-url-explorer-like)
- [BOTIFY_ANALYSIS_GET_URLS_DETAIL](#get-detail-for-some-urls)

### Get latest project's analyses

![image](https://cloud.githubusercontent.com/assets/1886834/14713052/e3dfa7e8-07df-11e6-9f23-52d7c9275a94.png)

```JS
/**
 * Return the latest analyses of a given project.
 * @param {String} apiToken Botify API token
 * @param {String} username Username of the project owner
 * @param {String} projectSlug Project's slug
 * @param {Number} nbAnalyses Number of analyses to get
 * @return {Array} The list of analyses.
 */
function BOTIFY_PROJECT_LIST_ANALYSES(apiToken, username, projectSlug, nbAnalyses)
```
### Aggregate project URLs data

![image](https://cloud.githubusercontent.com/assets/1886834/21591935/2bd3e4d6-d109-11e6-89dd-e1bd9b3a48a3.png)
![image](https://cloud.githubusercontent.com/assets/1886834/21591947/49fdef7e-d109-11e6-85bb-63a5be04b019.png)

```JS
/**
 * Return the result of an aggregation for latest project's analyses.
 * @param {String} apiToken Botify API token
 * @param {String} username Username of the project owner
 * @param {String} projectSlug Project's slug of the analysis
 * @param {BQLAggsQuery} urlsAggsQuery BQL Aggregation Query to perform
 * @param {Number} nbAnalyses Number of analyses to get
 * @return {Array} The result of the aggregation.
 */
function BOTIFY_PROJECT_AGGREGATE_URLS(apiToken, username, projectSlug, urlsAggsQuery, nbAnalyses)
```

This macro allow you to compute metrics like average depth, pagerank distribution, and much more for lastest analyses of an analyses.
You can also group URLs in order to compute the amount of visits generated by each segments, for instance..
For more information about how to define aggregation queries, please refer to the [[Aggregate URLs documentation;analysis-aggregate-urls]].


### Aggregate analysis URLs data

![image](https://cloud.githubusercontent.com/assets/1886834/21362231/bdd388b8-c6e7-11e6-984d-b97b8e5a20d6.png)

```JS
/**
 * Return the result of the aggregation on URLs of a given analyses
 * @param {String} apiToken Botify API token
 * @param {String} username Username of the project owner
 * @param {String} projectSlug Project's slug of the analysis
 * @param {String} analysisSlug Analysis's slug
 * @param {BQLAggsQuery} urlsAggsQuery BQL Aggregation Query to perform
 * @param {Boolean} showHeaders Show Groups and Metrics headers (default: true)
 * @return {Array} The result of the aggregation.
 */
function BOTIFY_ANALYSIS_AGGREGATE_URLS(apiToken, username, projectSlug, analysisSlug, urlsAggsQuery, showHeaders)
```

This macro allow you to compute metrics like average depth, pagerank distribution, and much more.
You can also group URLs in order to compute the amount of visits generated by each segments, for instance..
For more information about how to define aggregation queries, please refer to the [[Aggregate URLs documentation;analysis-aggregate-urls]].


### List URLs (URL explorer like)

![image](https://cloud.githubusercontent.com/assets/1886834/21352834/a0348eb6-c6c3-11e6-8702-2601d2ba905b.png)

```JS
/**
 * List URLs matching a given fitler
 * @param {String} apiToken Botify API token
 * @param {String} username Username of the project owner
 * @param {String} projectSlug Project's slug of the analysis
 * @param {String} analysisSlug Analysis's slug
 * @param {BQLFilter} filter Filter of apply on urls
 * @param {Range} fields Range of fields to fetch (ex A1:A4)
 * @param {BQLSort} sort Sort of apply on urls
 * @param {Number} size Number of urls to retrieve (max: 1000, default 100)
 * @param {Number} page Number of urls to retrieve (min: 1, default 1)
 * @param {Boolean} displayTotal Display the number of urls matching the filter
 * @return {Array} The value of the fields
 */
function BOTIFY_ANALYSIS_LIST_URLS(apiToken, username, projectSlug, analysisSlug, filter, fields, sort, size, page, displayTotal)
```

This macro works the same way the URL Explorer does, listing URLs matching a filter while allowing to sort and display a list of fields. It can at most list **1,000 URLs at a time**.


### Get detail for some URLs

![image](https://cloud.githubusercontent.com/assets/1886834/14742239/625eb72e-089b-11e6-95c2-d0897355982e.png)

```JS
/**
 * Return the requested fields of a list of URL
 * @param {String} apiToken Botify API token
 * @param {String} username Username of the project owner
 * @param {String} projectSlug Project's slug of the analysis
 * @param {String} analysisSlug Analysis's slug
 * @param {Range} urls Urls to get detail on
 * @param {Range} fields Range of fields to fetch (ex A1:A4)
 * @param {Boolean} showHeaders Show Groups and Metrics headers (default: true)
 * @return {Array} The value of the fields
 */
function BOTIFY_ANALYSIS_GET_URLS_DETAIL(apiToken, username, projectSlug, analysisSlug, urls, fields, showHeaders)
```
This macro allow you to retrieve fields data for a list of URLs.
**To avoid rate limit (429)** and get a faster response, **we highly recommend to give a list of URLs to a single cell formula** (as in the following example) instead of copying this macro for each URL.
Note a google script must respond within 30 seconds, thus if the list of URLs is too long, some URLs fields might not be computed, We recommend to give **at most 10,000 URLs**.



## FAQ

### How to get my API token?
You can get your API token in your user account page as explained [[there;authentication]].

### How to get my projectSlug and analysisSlug?
An easy way to get your projectSlug and analysisSlug is with the URL of your analysis report.
In the following example, `adam_warlock` is the username, `demo-project` is the projectSlug and `20160308` is the analysisSlug.

![image](https://cloud.githubusercontent.com/assets/1886834/14709625/e8aadb52-07d1-11e6-92f0-21dda26a6331.png)

### How to get the list of available fields?
A full list of available fields to display or compute metrics on can be found in the [[Analysis Datamodel;analysis-datamodel]].

### How to define an aggregation query?
Please refer to the [[Aggregate URLs documentation;analysis-aggregate-urls]].

### How to get the source code of the macros?
The source code of the Botify Google Sheets addon is open source and available on [Github](https://github.com/botify-labs/botify-integration-google-sheets). Feel free to customize our macros or contributing to the project.


## Troubleshooting

### I'm getting an #ERROR! with the code **429**

The HTTP Status Code 429 means that you reached the Botify API rate limit.
Keep in mind that each cell using a Botify Macro is requesting the Botify API on background, thus an excessive usage of Botify Macros may reach the limit.
Please refer to [[Rate Limit documentation;rate-limit]] for more details.
